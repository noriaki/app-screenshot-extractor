# 実装タスク

## タスク構成

- [ ] 1. CLI引数パーサーのモデル設定更新
  - `create_argument_parser()`関数の`--ai-model`オプション定義を更新
  - デフォルト値を`claude-sonnet-4-5-20250929`に変更
  - choicesリストを3つの最新モデルに更新（Haiku 4.5、Sonnet 4.5、Opus 4.1）
  - ヘルプテキストに各モデルの特性（速度・品質・コスト）を記載
  - _Requirements: 1.1, 2.1, 3.4_

- [ ] 2. AIContentGeneratorクラスのデフォルトモデル更新
  - `AIContentGenerator.__init__()`のmodelパラメータのデフォルト値を更新
  - デフォルト値を`claude-sonnet-4-5-20250929`に変更
  - ドキュメント文字列（docstring）のモデル情報を最新に更新
  - _Requirements: 1.2_

- [ ] 3. モデル設定の可視性向上実装
  - `AIContentGenerator.generate_article()`で使用モデル名を標準出力に表示
  - `ai_metadata.json`の`"model"`フィールドに使用モデル名を記録
  - 既存の出力フォーマットを維持しつつモデル情報を統合
  - _Requirements: 3.1, 3.2, 3.3_

- [ ] 4. 単体テストの更新と追加
- [ ] 4.1 CLI引数パーサーのテストケース更新
  - デフォルトモデルがSonnet 4.5であることを検証
  - choicesリストが3つの最新モデルを含むことを検証
  - 各モデル（Haiku、Sonnet、Opus）の有効性を個別に検証
  - 非推奨モデル指定時のエラーハンドリングを検証
  - 無効なモデル名指定時のエラーメッセージを検証
  - ヘルプテキストに価格情報が含まれることを検証
  - _Requirements: 1.1, 1.3, 2.1, 2.2, 3.4_

- [ ] 4.2 AIContentGeneratorクラスのテストケース更新
  - デフォルト初期化時にSonnet 4.5が設定されることを検証
  - 各モデル（Haiku、Sonnet、Opus）の初期化を個別に検証
  - generate_article()実行時に指定モデルがAPI呼び出しに使用されることを検証（モック）
  - ai_metadata.jsonに正しいモデル名が記録されることを検証
  - 標準出力にモデル名が表示されることを検証（capsys）
  - _Requirements: 1.2, 2.3, 3.1, 3.2_

- [ ] 5. 統合テストの更新と追加
- [ ] 5.1 エンドツーエンドフローのテストケース更新
  - デフォルトモデル（オプション省略）でのAI記事生成フローを検証
  - 各モデル指定（Haiku、Sonnet、Opus）でのAI記事生成フローを検証
  - ai_metadata.jsonに正しいモデル名が記録されることをエンドツーエンドで検証
  - _Requirements: 4.1, 4.2_

- [ ] 5.2 エラーハンドリングのテストケース追加
  - 非推奨モデル指定時のCLIエラー（exit code 2）を検証
  - 無効なモデル名指定時のargparseエラーメッセージを検証
  - エラーメッセージに有効な3つの選択肢がリストされることを検証
  - _Requirements: 1.3, 2.2_

- [ ] 6. requirements.txtの更新
  - `anthropic`パッケージのバージョン要件を確認（最小バージョン 0.43.0）
  - 必要に応じてバージョン制約をコメントで明記
  - _Requirements: 1.1_

- [ ] 7. 手動検証（E2Eテスト）
- [ ] 7.1 実際のClaude APIでの動作確認
  - Haiku 4.5モデルでAI記事生成を実行し、ai_metadata.jsonを確認
  - Sonnet 4.5モデル（デフォルト）でAI記事生成を実行し、ai_metadata.jsonを確認
  - Opus 4.1モデルでAI記事生成を実行し、ai_metadata.jsonを確認
  - 各モデルで正常に記事が生成され、品質メタデータが記録されることを確認
  - _Requirements: 2.3, 3.1, 3.2, 3.3_

- [ ] 7.2 エラーケースの手動確認
  - 非推奨モデル指定時のエラーメッセージを確認
  - 無効なモデル名指定時のエラーメッセージを確認
  - ヘルプメッセージ（`--help`）に各モデルの説明が表示されることを確認
  - _Requirements: 1.3, 2.2, 3.4_

- [ ] 8. リグレッションテストの実行
  - 全テストスイートを実行し、既存機能が正常に動作することを確認
  - モデル更新による既存テストケースへの影響がないことを確認
  - CLI引数の構造と順序が維持されていることを確認
  - 環境変数認証（ANTHROPIC_API_KEY）が引き続き動作することを確認
  - _Requirements: 4.2, 4.3, 4.4_

- [ ] 9. CHANGELOG.mdの更新
  - モデルアップグレードの変更内容を記録
  - 廃止されたモデルから新モデルへの移行を明記
  - デフォルトモデルの変更（claude-3-5-sonnet-20241022 → claude-sonnet-4-5-20250929）を記載
  - 3つのモデル選択肢（Haiku 4.5、Sonnet 4.5、Opus 4.1）の追加を記載
  - バージョン番号と日付を適切に設定
  - _Requirements: All (変更履歴の記録)_

- [ ] 10. README.mdの更新
  - 3つのモデルカテゴリ（Haiku、Sonnet、Opus）の説明を追加
  - 各モデルを使用するCLIコマンド例を提供
  - コスト・速度・品質の比較表を作成
  - モデル移行ガイド（旧モデルから新モデルへの置き換え手順）を記載
  - _Requirements: 5.1, 5.2, 5.3, 5.4_
